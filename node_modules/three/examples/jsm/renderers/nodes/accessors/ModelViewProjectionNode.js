import Node from 'three/examples/jsm/renderers/nodes/core/Node.js';
import CameraNode from 'three/examples/jsm/renderers/nodes/accessors/CameraNode.js';
import ModelNode from 'three/examples/jsm/renderers/nodes/accessors/ModelNode.js';
import OperatorNode from 'three/examples/jsm/renderers/nodes/math/OperatorNode.js';
import PositionNode from 'three/examples/jsm/renderers/nodes/accessors/PositionNode.js';

class ModelViewProjectionNode extends Node {

	constructor( position = new PositionNode() ) {

		super( 'vec4' );

		this.position = position;

		this._mvpMatrix = new OperatorNode( '*', new CameraNode( CameraNode.PROJECTION ), new ModelNode( ModelNode.VIEW ) );

	}

	generate( builder, output ) {

		const type = this.getType( builder );

		const mvpSnipped = this._mvpMatrix.build( builder );
		const positionSnipped = this.position.build( builder, 'vec3' );

		return builder.format( `( ${mvpSnipped} * vec4( ${positionSnipped}, 1.0 ) )`, type, output );

	}

}

export default ModelViewProjectionNode;
